<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | Notes</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/notes/logo.png">
    <link rel="manifest" href="/notes/manifest.json">
    <link rel="apple-touch-icon" href="/notes/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/notes/assets/css/0.styles.aa6162e3.css" as="style"><link rel="preload" href="/notes/assets/js/app.41d7de06.js" as="script"><link rel="preload" href="/notes/assets/js/2.2f2324fe.js" as="script"><link rel="preload" href="/notes/assets/js/51.e03a075e.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.5d7042fe.js"><link rel="prefetch" href="/notes/assets/js/11.1841a736.js"><link rel="prefetch" href="/notes/assets/js/12.01ce7f4c.js"><link rel="prefetch" href="/notes/assets/js/13.da763fe1.js"><link rel="prefetch" href="/notes/assets/js/14.85cd5338.js"><link rel="prefetch" href="/notes/assets/js/15.90d014a2.js"><link rel="prefetch" href="/notes/assets/js/16.e0ea8124.js"><link rel="prefetch" href="/notes/assets/js/17.4c1daa4f.js"><link rel="prefetch" href="/notes/assets/js/18.6713902b.js"><link rel="prefetch" href="/notes/assets/js/19.494f2130.js"><link rel="prefetch" href="/notes/assets/js/20.8d812d11.js"><link rel="prefetch" href="/notes/assets/js/21.139843ec.js"><link rel="prefetch" href="/notes/assets/js/22.2ab928a7.js"><link rel="prefetch" href="/notes/assets/js/23.a7739dc1.js"><link rel="prefetch" href="/notes/assets/js/24.d03f7cca.js"><link rel="prefetch" href="/notes/assets/js/25.4e2839e1.js"><link rel="prefetch" href="/notes/assets/js/26.620a6a11.js"><link rel="prefetch" href="/notes/assets/js/27.5dac51b1.js"><link rel="prefetch" href="/notes/assets/js/28.47b4071e.js"><link rel="prefetch" href="/notes/assets/js/29.32f5fee1.js"><link rel="prefetch" href="/notes/assets/js/3.232b4e43.js"><link rel="prefetch" href="/notes/assets/js/30.6abb2a42.js"><link rel="prefetch" href="/notes/assets/js/31.6e6b668d.js"><link rel="prefetch" href="/notes/assets/js/32.75960029.js"><link rel="prefetch" href="/notes/assets/js/33.e92e4965.js"><link rel="prefetch" href="/notes/assets/js/34.e979e435.js"><link rel="prefetch" href="/notes/assets/js/35.8df70758.js"><link rel="prefetch" href="/notes/assets/js/36.bd3c37cd.js"><link rel="prefetch" href="/notes/assets/js/37.47e8b255.js"><link rel="prefetch" href="/notes/assets/js/38.044411ff.js"><link rel="prefetch" href="/notes/assets/js/39.d2a1c017.js"><link rel="prefetch" href="/notes/assets/js/4.75f4d922.js"><link rel="prefetch" href="/notes/assets/js/40.be1f3994.js"><link rel="prefetch" href="/notes/assets/js/41.a25c50a6.js"><link rel="prefetch" href="/notes/assets/js/42.3de6ed44.js"><link rel="prefetch" href="/notes/assets/js/43.35448ab3.js"><link rel="prefetch" href="/notes/assets/js/44.41515846.js"><link rel="prefetch" href="/notes/assets/js/45.9debb209.js"><link rel="prefetch" href="/notes/assets/js/46.d8c48295.js"><link rel="prefetch" href="/notes/assets/js/47.2df1f282.js"><link rel="prefetch" href="/notes/assets/js/48.c16a1e53.js"><link rel="prefetch" href="/notes/assets/js/49.dbe7e030.js"><link rel="prefetch" href="/notes/assets/js/5.b37c116b.js"><link rel="prefetch" href="/notes/assets/js/50.9d6965c1.js"><link rel="prefetch" href="/notes/assets/js/52.689a839d.js"><link rel="prefetch" href="/notes/assets/js/53.3044b538.js"><link rel="prefetch" href="/notes/assets/js/54.699f0a83.js"><link rel="prefetch" href="/notes/assets/js/55.c442139f.js"><link rel="prefetch" href="/notes/assets/js/56.454dc04a.js"><link rel="prefetch" href="/notes/assets/js/57.9c72a8eb.js"><link rel="prefetch" href="/notes/assets/js/58.213ff623.js"><link rel="prefetch" href="/notes/assets/js/59.62255858.js"><link rel="prefetch" href="/notes/assets/js/6.b2f21d91.js"><link rel="prefetch" href="/notes/assets/js/60.aee2303f.js"><link rel="prefetch" href="/notes/assets/js/61.599518ac.js"><link rel="prefetch" href="/notes/assets/js/62.47d23efb.js"><link rel="prefetch" href="/notes/assets/js/63.3fa4f7be.js"><link rel="prefetch" href="/notes/assets/js/64.5cfe2fb9.js"><link rel="prefetch" href="/notes/assets/js/65.7c228b4c.js"><link rel="prefetch" href="/notes/assets/js/66.c6e2c82b.js"><link rel="prefetch" href="/notes/assets/js/67.3aba7229.js"><link rel="prefetch" href="/notes/assets/js/68.20dac209.js"><link rel="prefetch" href="/notes/assets/js/69.e19950ac.js"><link rel="prefetch" href="/notes/assets/js/7.bea8cd98.js"><link rel="prefetch" href="/notes/assets/js/70.fc0e7e90.js"><link rel="prefetch" href="/notes/assets/js/71.149abbca.js"><link rel="prefetch" href="/notes/assets/js/72.45e10354.js"><link rel="prefetch" href="/notes/assets/js/73.e0cf9bca.js"><link rel="prefetch" href="/notes/assets/js/74.bf5a7f05.js"><link rel="prefetch" href="/notes/assets/js/75.33ec0b05.js"><link rel="prefetch" href="/notes/assets/js/76.79b0bfc5.js"><link rel="prefetch" href="/notes/assets/js/77.878ac7f9.js"><link rel="prefetch" href="/notes/assets/js/78.42f3ba60.js"><link rel="prefetch" href="/notes/assets/js/79.c9b50231.js"><link rel="prefetch" href="/notes/assets/js/8.14f8a4c8.js"><link rel="prefetch" href="/notes/assets/js/80.f41b4cbc.js"><link rel="prefetch" href="/notes/assets/js/81.5c2f5131.js"><link rel="prefetch" href="/notes/assets/js/82.b4664c70.js"><link rel="prefetch" href="/notes/assets/js/83.baa16c35.js"><link rel="prefetch" href="/notes/assets/js/84.61748c0f.js"><link rel="prefetch" href="/notes/assets/js/85.f603d6b6.js"><link rel="prefetch" href="/notes/assets/js/86.c646284a.js"><link rel="prefetch" href="/notes/assets/js/9.1e6ccf2c.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.aa6162e3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/notes/animation/" class="nav-link">
  动画
</a></div><div class="nav-item"><a href="/notes/interview/" class="nav-link router-link-active">
  面试
</a></div><div class="nav-item"><a href="/notes/tool/" class="nav-link">
  工具库
</a></div> <a href="https://github.com/kaypler/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/notes/animation/" class="nav-link">
  动画
</a></div><div class="nav-item"><a href="/notes/interview/" class="nav-link router-link-active">
  面试
</a></div><div class="nav-item"><a href="/notes/tool/" class="nav-link">
  工具库
</a></div> <a href="https://github.com/kaypler/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>经验之谈</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/interview/experience/browse-cache.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/notes/interview/experience/browse.html" class="sidebar-link">浏览器</a></li><li><a href="/notes/interview/experience/cross-platform.html" class="sidebar-link">跨端</a></li><li><a href="/notes/interview/experience/css.html" class="sidebar-link">CSS</a></li><li><a href="/notes/interview/experience/event-loop.html" class="sidebar-link">Event Loop</a></li><li><a href="/notes/interview/experience/js.html" class="sidebar-link">Javascript</a></li><li><a href="/notes/interview/experience/miniprogram.html" class="sidebar-link">小程序</a></li><li><a href="/notes/interview/experience/network.html" class="sidebar-link">网络</a></li><li><a href="/notes/interview/experience/react.html" class="sidebar-link">React</a></li><li><a href="/notes/interview/experience/safety.html" class="sidebar-link">安全篇</a></li><li><a href="/notes/interview/experience/vite.html" class="sidebar-link">Vite</a></li><li><a href="/notes/interview/experience/vue.html" class="sidebar-link">Vue</a></li><li><a href="/notes/interview/experience/webpack.html" aria-current="page" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack打包原理" class="sidebar-link">webpack打包原理</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack热更新原理" class="sidebar-link">webpack热更新原理</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack模块加载原理" class="sidebar-link">webpack模块加载原理</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack的缺点" class="sidebar-link">webpack的缺点</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack4的splitchunks" class="sidebar-link">webpack4的splitChunks</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#webpack中的sourcemap" class="sidebar-link">webpack中的Sourcemap</a></li><li class="sidebar-sub-header"><a href="/notes/interview/experience/webpack.html#提升webpack打包速度" class="sidebar-link">提升webpack打包速度</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>手写系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/interview/handwrite/ajax.html" class="sidebar-link">ajax</a></li><li><a href="/notes/interview/handwrite/async.html" class="sidebar-link">Async函数实现</a></li><li><a href="/notes/interview/handwrite/clone.html" class="sidebar-link">拷贝</a></li><li><a href="/notes/interview/handwrite/debounce-and-throttle.html" class="sidebar-link">防抖与节流</a></li><li><a href="/notes/interview/handwrite/design-pattern.html" class="sidebar-link">设计模式</a></li><li><a href="/notes/interview/handwrite/event.html" class="sidebar-link">事件订阅</a></li><li><a href="/notes/interview/handwrite/extend.html" class="sidebar-link">寄生组合式继承</a></li><li><a href="/notes/interview/handwrite/js-base.html" class="sidebar-link">javascript底层函数实现</a></li><li><a href="/notes/interview/handwrite/jsonp.html" class="sidebar-link">jsonp</a></li><li><a href="/notes/interview/handwrite/lru-cache.html" class="sidebar-link">LRU 缓存机制</a></li><li><a href="/notes/interview/handwrite/promise.html" class="sidebar-link">promise</a></li><li><a href="/notes/interview/handwrite/serial-and-concurrent.html" class="sidebar-link">串行和并行</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能调优</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/interview/optimize/browse.html" class="sidebar-link">浏览器性能优化</a></li><li><a href="/notes/interview/optimize/react.html" class="sidebar-link">React</a></li><li><a href="/notes/interview/optimize/weex.html" class="sidebar-link">weex</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>大厂真题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/interview/subject/ali-2021.html" class="sidebar-link">阿里2021第一轮笔试</a></li><li><a href="/notes/interview/subject/css.html" class="sidebar-link">CSS题目</a></li><li><a href="/notes/interview/subject/futu-2021.html" class="sidebar-link">富途2021面试</a></li><li><a href="/notes/interview/subject/js-advance.html" class="sidebar-link">JS真题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <h2 id="webpack打包原理"><a href="#webpack打包原理" class="header-anchor">#</a> webpack打包原理</h2> <ol><li>识别入口文件，逐级递归识别依赖，构建依赖图谱</li> <li>将代码转化为AST抽象语法树</li> <li>在AST阶段中去处理代码</li> <li>把AST抽象语法树变成浏览器可以识别的代码，然后输出</li></ol> <h2 id="webpack热更新原理"><a href="#webpack热更新原理" class="header-anchor">#</a> webpack热更新原理</h2> <p>webpack-dev-server主要包含了三个部分：</p> <ol><li>webpack: 负责编译代码</li> <li>webpack-dev-middleware: 主要负责构建内存文件系统，把webpack的 OutputFileSystem 替换成 InMemoryFileSystem。同时作为Express的中间件拦截请求，从内存文件系统中把结果拿出来。</li> <li>express：负责搭建请求路由服务。</li></ol> <p>热更新流程：</p> <ol><li>启动dev-server，webpack开始构建，在编译期间会向 entry 文件注入热更新代码；</li> <li>Client 首次打开后，Server 和 Client 基于Socket建立通讯渠道；</li> <li>修改文件，Server 端监听文件发送变动，webpack开始编译，直到编译完成会触发&quot;Done&quot;事件；</li> <li>Server通过socket 发送消息告知 Client；</li> <li>Client根据Server的消息（hash值和state状态），通过ajax请求获取 Server 的manifest描述文件；</li> <li>Client对比当前 modules tree ，再次发请求到 Server 端获取新的JS模块；</li> <li>Client获取到新的JS模块后，会更新modules tree并替换掉现有的模块；</li> <li>最后调用 module.hot.accept() 完成热更新；</li></ol> <h2 id="webpack模块加载原理"><a href="#webpack模块加载原理" class="header-anchor">#</a> webpack模块加载原理</h2> <ul><li><strong>同步模块</strong>：ES6 module 在底层实际上被 webpack 转换成了类似于 CommonJS 的语法。<a href="https://zhuanlan.zhihu.com/p/88335687" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>异步模块</strong>：jsonp的方式。<a href="https://zhuanlan.zhihu.com/p/53044886" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="webpack的缺点"><a href="#webpack的缺点" class="header-anchor">#</a> webpack的缺点</h2> <ol><li>缓慢的服务器启动。当冷启动开发服务器时，基于打包的方式是在提供服务前去急切地抓取和构建你地整个应用。</li> <li>使用地是node.js去实现。</li> <li>热更新效率低下。当基于打包器启动时，编辑文件后将重新构建文件本身。显然我们不应该重新构建整个包，
因为这样更新速度会随着应用体积增长而直线下降。</li></ol> <h2 id="webpack4的splitchunks"><a href="#webpack4的splitchunks" class="header-anchor">#</a> webpack4的splitChunks</h2> <p>splitChunks是webpack4推出的一个分包规则，它有一个默认的配置，这也符合webpack4开箱即用的特性，它的默认配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="chunks"><a href="#chunks" class="header-anchor">#</a> chunks</h3> <p>chunks的含义是拆分模块的范围，它有三个值async、initial和all。</p> <ul><li><strong>async</strong>表示只从异步加载得模块（动态加载import()）里面进行拆分</li> <li><strong>initial</strong>表示只从入口模块进行拆分</li> <li><strong>all</strong>表示以上两者都包括</li></ul> <h3 id="cachegroups"><a href="#cachegroups" class="header-anchor">#</a> cacheGroups</h3> <p>splitChunks就是根据cacheGroups去拆分模块的，包括之前说的chunks属性和之后要介绍的种种属性其实都是对缓存组进行配置的。
splitChunks默认有两个缓存组：vender和default。</p> <p>另外还需要说明一下，cacheGroups之外设置的约束条件比如说默认配置里面的chunks、minSize、minChunks等等都会作用于cacheGroups，
除了test, priority and reuseExistingChunk，这三个是只能定义在cacheGroup这一层的。cacheGroups也可以将上面的所有属性都重新定义，
就会覆盖外面的默认属性，比如default这个缓存组就设置了minChunks=2，他会覆盖掉默认值1。</p> <p>priority的含义是权重，如果有一个模块满足了多个缓存组的条件就会去按照权重划分，谁的权重高就优先按照谁的规则处理。</p> <h3 id="maxinitialrequests"><a href="#maxinitialrequests" class="header-anchor">#</a> maxInitialRequests</h3> <p>maxInitialRequests是splitChunks里面比较难以理解的点之一，它表示允许入口并行加载的最大请求数，
之所以有这个配置也是为了对拆分数量进行限制，不至于拆分出太多模块导致请求数量过多而得不偿失。</p> <p>这里需要注意几点：</p> <ul><li>入口文件本身算一个请求</li> <li>如果入口里面有动态加载得模块这个不算在内</li> <li>通过runtimeChunk拆分出的runtime不算在内</li> <li>只算js文件的请求，css不算在内</li> <li>如果同时又两个模块满足cacheGroup的规则要进行拆分，但是maxInitialRequests的值只能允许再拆分一个模块，那尺寸更大的模块会被拆分出来</li></ul> <h3 id="maxasyncrequests"><a href="#maxasyncrequests" class="header-anchor">#</a> maxAsyncRequests</h3> <p>maxAsyncRequests和maxInitialRequests有相似之处，它俩都是用来限制拆分数量的，maxInitialRequests是用来限制入口的拆分数量
而maxAsyncRequests是用来限制异步模块内部的并行最大请求数的，说白了你可以理解为是每个import()它里面的最大并行请求数量。</p> <p>这其中要注意以下几点：</p> <ul><li>import()文件本身算一个请求</li> <li>并不算js以外的公共资源请求比如css</li> <li>如果同时有两个模块满足cacheGroup的规则要进行拆分，但是maxInitialRequests的值只能允许再拆分一个模块，那尺寸更大的模块会被拆分出来</li></ul> <p><strong>splitChunks之其余要点</strong></p> <ul><li>splitChunks.cacheGroup必须同时满足各个条件才能生效，这个之前我理解错误，我以为比如minSize或是minChunks等条件只要满足一条就可以拆分，但是实际上必须同时满足才行</li> <li>splitChunks的配置项都是作用于cacheGroup上的，如果将cacheGroup的默认两个分组vendor和default设置为false，则splitChunks就不会起作用</li> <li>minChunks、maxAsyncRequests、maxInitialRequests的值必须设置为大于等于1的数</li> <li>当chunk没有名字时，通过splitChunks分出的模块的名字用id替代，当然你也可以通过name属性自定义</li> <li>当父chunk和子chunk同时引入相同的module时，并不会将其分割出来而是删除掉子chunk里面共同的module，保留父chunk的module，这个是因为 optimization.removeAvaliableModules 默认是true</li> <li>当两个cacheGroup.priority相同时，先定义的会先命中</li> <li>除了js，splitChunks也适用于css</li></ul> <h2 id="webpack中的sourcemap"><a href="#webpack中的sourcemap" class="header-anchor">#</a> webpack中的Sourcemap</h2> <p>Sourcemap 本质上是一个信息文件，里面储存着代码转换前后的对应位置信息。
Sourcemap 解决了在打包过程中，代码经过压缩，去空格以及 babel 编译转化后，由于代码之间差异性过大，造成无法debug的问题.</p> <p>webpack中的sourcemap的基本类型包括：</p> <ol><li><strong>eval</strong>: 将每一个module模块，执行eval，执行后不会生成sourcemap文件，仅仅是在每一个模块后，增加sourceURL来关联模块处理前后的对应关系</li> <li><strong>soure-map</strong>: 为每一个打包后的模块生成独立的soucemap文件</li> <li><strong>inline</strong>: 与source-map不同，增加inline属性后，不会生成独立的.map文件，而是将.map文件以dataURL的形式插入</li> <li><strong>cheap</strong>: cheap属性在打包后同样会为每一个模块生成.map文件，但是与source-map的区别在于cheap生成的.map文件会忽略原始代码中的列信息</li> <li><strong>module</strong>: 含了loader模块之间的sourcemap</li></ol> <p><strong>总结：</strong></p> <ul><li>在开发环境中我们使用：<code>cheap-module-eval-source-map</code></li> <li>在生产环境中我们使用：<code>cheap-module-source-map</code></li></ul> <p><code>eval-source-map</code>组合使用是指将.map以DataURL的形式引入到打包好的模块中，类似于inline属性的效果，我们在生产中，使用<code>eval-source-map</code>会使打包后的文件太大，
因此在生产环境中不会使用``eval-source-map`。但是因为eval的rebuild速度快，因此我们可以在本地环境中增加eval属性。</p> <h2 id="提升webpack打包速度"><a href="#提升webpack打包速度" class="header-anchor">#</a> 提升webpack打包速度</h2> <ol><li>使用<code>webpack-bundle-analyzer</code>对项目进行模块分析生成report，查看report后看看哪些模块体积过大，然后针对性优化；</li> <li>配置<code>externals</code>，防止将某些import的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖；</li> <li>缩小loader的查询范围，例如：rules中loader添加：<code>include: path.resolve(__dirname, 'src')</code>；</li> <li><code>thread-loader</code>可以将非常消耗资源的loaders转存到worker pool中；</li> <li>使用<code>cache-loader</code>启用持久化缓存，使用 package.json 中的 postinstall 清除缓存目录；</li> <li>使用<code>alias</code>可以更快地找到对应文件；</li> <li>配置<code>extensions</code>，可以让webpack少做一点后缀匹配；</li> <li>生产环境不开启lint，使用pre-commit或者husky在提交前校验；</li> <li>webpack提供的UglifyJS插件采用单线程压缩，速度很慢。所以将此插件替换为webpack-parallel-uglify-plugin插件，此插件可以并行运行UglifyJS插件，可有效减少构建时间；</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ParallelUglifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-parallel-uglify-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">ParallelUglifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  cacheDir<span class="token operator">:</span> <span class="token string">'.cache/'</span><span class="token punctuation">,</span>
  uglifyJS<span class="token operator">:</span><span class="token punctuation">{</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
      comments<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token punctuation">{</span>
      warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      drop_debugger<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      drop_console<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="6"><li>使用dll plugin；</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//首先在build文件下创建一个js文件,webpack.dll.conf.js，并写入下方代码</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package'</span><span class="token punctuation">)</span><span class="token comment">//引入package文件，目的就是找到依赖</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 想要打包的模块的数组</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// vendor: ['axios', 'vue-router', 'vue','weixin-js-sdk','element-ui','vuex']</span>
    vendor<span class="token operator">:</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span><span class="token comment">//取出所有依赖单独打包</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static/js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 打包后文件输出的位置</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span><span class="token comment">//生成的文件名字 默认为vendor.dll.js</span>
    library<span class="token operator">:</span> <span class="token string">'[name]_library'</span><span class="token comment">//生成文件的映射关系，与下面的DLLPlugin配置相对应</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//生成一个json文件 里面是关于dll.js的配置信息</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'[name]-manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'[name]_library'</span><span class="token punctuation">,</span><span class="token comment">//与上面output中的配置对应</span>
      context<span class="token operator">:</span> __dirname<span class="token comment">//上下文环境路径，必须填写，为了与DLLReferencePlugin存在于同一上下文中，否则undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 压缩打包的文件</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      uglifyOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        compress<span class="token operator">:</span> <span class="token punctuation">{</span>
              warnings<span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">//然后在webpack.prod.conf.js和webpack.dev.conf.js中加入当前插件</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span><span class="token comment">//与DllPlugin中的context保持一致</span>
  <span class="token comment">/*这个地址对应webpack.dll.conf.js中生成的那个json文件的路径，这样webpack打包的时候
  会检测当前文件中的映射，不会把已经存在映射的包再次打包进bundle.js */</span>
  manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./vendor-manifest.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">//在package.json中新加一条npm命令，执行webpack.dll.conf.js文件</span>
<span class="token string">&quot;dll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.dll.conf.js&quot;</span>
<span class="token comment">//tips：每次添加新依赖后，一定要运行npm run dll这个命令一次。</span>

<span class="token comment">//最后在index.html中引入static/js/vendor.dll.js文件</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;static/js/vendor.dll.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/interview/experience/vue.html" class="prev">
        Vue
      </a></span> <span class="next"><a href="/notes/interview/handwrite/ajax.html">
        ajax
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.41d7de06.js" defer></script><script src="/notes/assets/js/2.2f2324fe.js" defer></script><script src="/notes/assets/js/51.e03a075e.js" defer></script>
  </body>
</html>
