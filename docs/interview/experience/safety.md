# 安全篇

## XSS
**跨站脚本攻击**，英文全称是Cross Site Script。XSS攻击，通常是指黑客通过“HTML注入”篡改了网页，插入了恶意的脚本，
从而在用户浏览网页时，控制用户浏览器的一种攻击。在一开始，这种攻击的演示案例是跨域的，所以叫“跨站脚本”。但是发展到今天，由于
JavaScript的强大功能以及网站前端应用的复杂化，是否跨域已经不重要。

XSS攻击有以下分类：
- **反射型XSS**只是简单地把用户输入地数据“反射”给浏览器。也就是说，黑客往往需要诱使用户“点击”一个恶意链接，才能成功。
- **存储型XSS**会把用户输入地数据“存储”在服务器端。这种XSS具有很强地稳定性。
- **DOM Based XSS**是通过修改页面的DOM节点形成的XSS。

DOM型XSS跟前面两种XSS的区别：DOM型XSS攻击中，取出和执行恶意代码由浏览器端完成，属于前端Javascript自身的漏洞，
而其他两种都属于服务端的安全漏洞。

XSS注入的方法：
- 在HTML中内嵌的文本中，恶意内容以script标签形式注入
- 在内联的Javascript中，拼接的数据突破了原本的限制
- 在标签属性中，恶意内容包含引号，从而突破属性的限制，注入其它属性或标签
- 在标签的href、src等属性中，包含javascript: 等可执行代码
- 在onload、onerror、onclick等事件中，注入不受控制代码
- 在style属性和标签中，包含类似`background-image: url("javascript:...");`的代码 (新版本浏览器已经可以防范) 
- 在style属性和标签中，包含类似`expression(...);`的代码 (新版本浏览器已经可以防范) 

XSS攻击的危害：
- Cookie劫持，可以通过document.cookie获取用户的cookie信息
- 构造GET与POST请求
- 识别用户的浏览器
- 识别用户安装的软件
- 获取用户曾经访问过的网站
- XSS Worm

XSS的防御
- 服务器发送Set-Cookie头，设置**HttpOnly**
- 输入检查和长度限制，（对<、>、'、"等特殊字符转义，假如要输出到多个端就不适用了）
- 输出检查，json数据要采取特殊的转义
- 富文本禁止事件，过滤危险标签`<iframe>`,`script`,`base`,`form`，建议使用白名单。
- 对于链接跳转，如`<a href="xxx"` 或 `location.href="xxx"`，要禁止以javascript开头的链接和其他非法的scheme。
- 避免拼接HTML，使用createElement.setAttribute的方法实现

**HtmlEncode:**
| 原字符      | 转义字符   |
| :--------- | :-------  |
| &          | \&amp;    |
| <          | \&lt;     | 
| >          | \&gt;     | 
| "          | \&quot;   |
| '          | \&#x27;   | 
| /          | \&#x2F;   | 

## CSRF
CSRF的全名是Cross Site Request Forgery，翻译成中文就是跨站点请求伪造。
攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，
绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。

CSRF通常是跨域的，因为外域通常更容易被攻击者掌控。但是如果本域下有容易被利用的功能，比如可以发图和链接的论坛和评论区，攻击
可以直接在本域进行，而且这种攻击更加危险。

CSRF的特点：
- 攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。
- 攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。
- 跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。

CSRF的防御：
- 验证码
- Referer Check，检查请求是否来自合法的源
- token

## ClickJacking
点击劫持是一种视觉上的欺骗手段。攻击者使用一个透明的、不可见的iframe，覆盖在一个网页上，然后诱使用户在该网页上进行操作，
此时用户将在不知情的情况下点击透明的iframe页面。


## DDOS
DDOS又称分布式拒绝服务，全程是Distributed Denial of Service。DDOS本是利用合理的请求造成资源过载，导致服务不可用。

## 运营商劫持
一般情况下，运营商劫持指http劫持
在用户的客户端与其要访问的服务器经过网络协议协调后，二者之间建立了一条专用的数据通道，用户端程序在系统中开放指定网络端口用于接收数据报文，服务器端将全部数据按指定网络协议规则进行分解打包，形成连续数据报文。
HTTP劫持是在使用者与其目的网络服务所建立的专用数据通道中，监视特定数据信息，提示当满足设定的条件时，就会在正常的数据流中插入精心设计的网络数据报文，目的是让用户端程序解释“错误”的数据，并以弹出新窗口的形式在使用者界面展示宣传性广告或者直接显示某网站的内容。
这是目前各大运营商向用户访问的页面中注入广告的主要途径，用于谋取额外的利益。

## CSP
内容安全策略 (CSP) 是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括跨站脚本 (XSS) 和数据注入攻击等。
无论是数据盗取、网站内容污染还是散发恶意软件，这些攻击都是主要的手段。

为使CSP可用, 你需要配置你的网络服务器返回  Content-Security-Policy  HTTP头部 ( 有时你会看到一些关于X-Content-Security-Policy头部的提法, 那是旧版本，你无须再如此指定它)。
除此之外,  `<meta>` 元素也可以被用来配置该策略, 例如
>\<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';">